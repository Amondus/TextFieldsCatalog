# Возможности полей ввода

## Содержание

- [Существующие типы полей](#Существующие-типы-полей)
- [Конфигурация проекта](#Конфигурация-проекта)
- [Доступные методы](#Доступные-методы)
- [Замыкания](#Замыкания)
- [HeightLayoutPolicy](#HeightLayoutPolicy)
- [TextFieldMode](#TextFieldMode)
- [Кастомные клавиатуры и переключение полей](#Кастомные-клавиатуры–и-переключение-полей)

## Существующие типы полей

Все поля выполнены по одному принципу - это UIView, некая обертка над UITextField/UITextView, где помимо полей содержатся другие элементы, как UILabel с подсказками/ошибками, плейсхолдеры, кнопки, а доступ к самим полям ввода напрямую извне закрыт.

На данный момент в проекте имеются следующие виды полей ввода:

### BorderedTextField
<p align="center">
	<img src="./Images/BorderedTextField.png" />
</p>

Отличительная особенность поля - оно имеет статичный плейсхолдер, а UITextField имеет границу.

### UnderlinedTextField
<p align="center">
	<img src="./Images/UnderlinedTextField.png" />
</p>

Отличительными особенностями данного поля являются:

* возможность показа под полем ввода подчеркивающей линии (или вы можете скрыть ее)
* плейсхолдер выполнен как CATextLayer, что дает возможность менять текст, кегль шрифта и положение плейсхолдера при переходе между состояниями анимационно одновременно

### UnderlinedTextView
<p align="center">
	<img src="./Images/UnderlinedTextView.png" />
</p>

Данное поле - обертка над UITextView, а не над UITextField, как предыдущие. Область применения - поля ввода, где ожидается наличие большого количества текста, который пользователь должен видеть полностью, потому поле при увеличении количества текста растягивается в высоту.

## Конфигурация проекта

**Эта секция для тех, кто хочет добавить новое поле ввода/изменить поведение существующего.**

Для установки всех необходимых утилит достаточно выполнить команду `make init`.

Скрипт установит все необходимые зависимости нужных версий при помощи `bundler`, а также выполнит команду `pod install`.

После выполнения скрипта можно открывать .xcworkspace файл проекта и начинать над ним работу.

**Важно** - возможны проблемы с версией `bundler`, если текущая установленная версия конфликтует с необходимыми для работы проекта гемами. Рекомендуется использовать версию **1.17.1**

Дальнейшее использование Gem зависимостей необходимо выполнять при помощи версий, установленных через `bundler`. Для облегчения работы - на все основные команды написаны обертки, вызывающие их через `bundler`.

Например, CocoaPods зависимости устанавливаются при помощи команды: `make pod`.

Для вывода в консоль всех возможных команд вместе с их описанием - достаточно вызывать команду `make help`.

## Доступные методы

Данная секция содержит описания методов и область их применения, которые доступны в большинстве полей ввода в данной библиотеке.

````swift
func configure(placeholder: String?, maxLength: Int?)
````
Метод позволяет установить плейсхолдер, а также ограничить максимальное число символов в поле. Пользователь физически не сможет ввести строку больше, чем `maxLength`.

**Важно**: при использования `MaskFormatter` поле `maxLength` становится бесполезным в силу того, что теряется возможность контроллировать число символов, введенных пользователем, из-за использования сторонней библиотеки для реализации форматтеров. Подробную информацию о данном механизме можно найти ниже.

````swift
func configure(heightConstraint: NSLayoutConstraint)
````
В полях ввода предусмотрены два режима работы - работа в рамках фиксированной высоты элемента и изменяемой (подробнее об этом можно прочитать ниже в рамках заметки о HeightLayoutPolicy). В случае работы в режиме изменяемой высоты - поле будет менять свои размеры (а следственно и расположение своих внутренних элементов) в процессе работы. 

Чтобы при этом менялась высота и самого контейнера (которая обычно задается извне, при создании самого элемента в вашем проекте) - необходимо передать полю объект `NSLayoutConstraint` с помощью данного метода, значение которого будет управляться самим полем. 

Альтернативный способ - использовать замыкание `onHeightChanged`, в котором будет передаваться значение новой высоты элемента, чтобы обновить его самому.

````swift
func configure(correction: UITextAutocorrectionType?, keyboardType: UIKeyboardType?)
````
Метод позволяет установить `UITextAutocorrectionType` для поля ввода, а также тип клавиатуры. Можно передать nil, тогда параметр обновляться не будет.

````swift
func configure(autocapitalizationType: UITextAutocapitalizationType)
````
Метод позволяет установить `UITextAutocapitalizationType` для поля ввода. Может быть полезно, к примеру, для полей ввода ФИО, где каждое новое слово необходимо писать с новой буквы.

````swift
func configureContentType(_ contentType: UITextContentType)
````
Метод позволяет установить `UITextContentType` для поля ввода.

````swift
func setText(_ text: String?)
````
В силу того, что доступ к UITextField напрямую закрыт - данный метод служит для установки текста в поле ввода.

````swift
func currentText() -> String?
````
А с помощью данного метода можно получить текущее значение, введенное в поле ввода.

````swift
func hideKeyboard()
````
Вызов данного метода приведет к сокрытию клавиатуры, в случае если поле ввода будет в фокусе (вместо клавиатуры покажется `ничего`). Может быть полезно в тех случаях, когда вместо показа клавиатуры необходимо сделать что-то другое (показать ячейку таблицы, к примеру).

````swift
func setTextFieldIdentifier(_ identifier: String)
````
В случае, если на вашем проекте есть практика написаний UI-тестов - данный метод позволит установить accessibilityIdentifiers к элементам поля ввода. Правила составления идентификаторов следующие: если передать в метод строку вида `phoneField`, то 
* на контейнер с полем ввода будет установлен идентификатор вида `phoneField`
* на UITextField/UITextView будет установлен идентификатор вида `phoneField_input`
* на кнопку в поле ввода - `phoneField_button`
* на лейбл с подсказкой - `phoneField_hint`

````swift
func setError(with errorMessage: String?, animated: Bool)
````
Метод позволяет установить ошибку в поле ввода, передав при необходимости некоторое сообщение, которое будет отображено в информационном лейбле.

````swift
func isValidState(forceValidate: Bool = false) -> Bool
````
Основной метод, с помощью которого можно произвести валидацию введенных значений в поле ввода. В процессе вызова - будет вызван метод, проводящий валидацию текста в поле ввода, будут обновлены все внутренние переменные, а UI обновится в соответствии с их состоянием. Параметр forceValidate позволяет провести валидацию даже в том случае, если в данный момент в поле ввода установлена ошибка, при передаче же `false` - валидация и обновление состояния произведены не будут, если поле уже в состоянии ошибки.

````swift
func reset()
````
Метод позволяет откатить поле ввода до девственного состояния, очистив текст и обновив все внутренние переменные.

````swift
func resetErrorState()
````
Данный же метод позволяет только сбросить состояние ошибки, может быть полезен в случае, когда необходимо сбросить ошибку, но сохранить текущий введенный текст.

````swift
func disablePasteAction()
````
Метод позволяет запретить вставку текста в поле ввода.

````swift
func disableTextField()
````
Метод позволяет сделать поле ввода неактивным.

````swift
func enableTextField()
````
Метод позволяет сделать поле ввода активным, готовым к взаимодействию с пользователем.

````swift
func isEnabled() -> Bool
````
Возвращает `true`, если в данный момент поле ввода готово к взаимодействию с пользователем, `false` в противном случае.

````swift
func setHint(_ hint: String)
````
Данный метод позволяет установить в информационный лейбл некоторый текст-подсказку, который будет отображаться пользователю, когда поле ввода в фокусе. Данное сообщение будет заменяться сообщением об ошибке в случае, если возникает ошибка и ей соответствует какой-либо текст.

````swift
func isCurrentFirstResponder() -> Bool
````
Возвращает `true`, если поле ввода находится в фокусе, `false` в противном случае.

````swift
func makeFirstResponder()
````
В силу того, что UITextField/UITextView напрямую закрыты от воздействия извне, то данный метод: единственная возможность сделать поле ввода активным (в фокусе) из кода.

````swift
func setReturnKeyType(_ type: UIReturnKeyType)
````
Метод позволяет установить UIReturnKeyType для поля ввода. (Метод **отсутствует** в UnderlinedTextView в силу того, что кнопка `return` в UITextView обычно служит для переноса строки)

## Замыкания

В процессе работы поля ввода возникает ряд событий, о которых может быть полезно знать извне. На все такие события прокинуты замыкания:

* ```var onBeginEditing: ((UnderlinedTextField) -> Void)?``` - вызвается в начале редактирования значения в поле ввода
* ```var onEndEditing: ((UnderlinedTextField) -> Void)?``` - после окончания редактирования
* ```var onTextChanged: ((UnderlinedTextField) -> Void)?``` - при смене текста в поле ввода
* ```var onShouldReturn: ((UnderlinedTextField) -> Void)?``` - в случае нажатия кнопки `return`
* ```var onActionButtonTap: ((UnderlinedTextField) -> Void)?``` - в случае нажатия кнопки внутри поля ввода
* ```var onValidateFail: ((UnderlinedTextField) -> Void)?``` - в случае, если введенное в поле ввода значение не прошло проверку
* ```var onHeightChanged: ((CGFloat) -> Void)?``` - при смене высоты элемента

## HeightLayoutPolicy

При использовании полей ввода есть возможность выбрать из двух доступных вариантов режима работы с высотой поля:

* `.fixed` - поле ввода будет иметь фиксированную высоту, которую элемент имеет при создании
* `.flexible(CGFloat, CGFloat)` - высота будет изменяться в зависимости от наличия ошибки/подсказки/состояния поля ввода. При этом обязательно указать два значения: минимальную высоту поля ввода, а также минимальное расстояние от лейбла с подсказкой до нижней границы поля

## TextFieldMode

Поля ввода (кроме UnderlinedTextView) имеют возможность установки так называемого `мода`, которым регулируется наличие и поведение кастомной кнопки внутри поля:

* `.plain` - простое поле ввода без дополнительных кнопок
* `.password` - в данном режиме поле ввода заточено под работу с полями ввода: кнопка принимает форму 'глазика', при нажатии на кнопку меняется свойство поля isSecureTextEntry
* `.custom(ActionButtonConfiguration)` - позволяет добавить к полю ввода любую кнопку на ваше усмотрение. Нажатие же на нее можно отловить с помощью замыкания `onActionButtonTap`

## Кастомные клавиатуры и переключение полей







